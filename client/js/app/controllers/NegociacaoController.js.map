{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacoes","Mensagem","NegociacoesView","MensagemView","NegociacaoService","DateHelper","Bind","Negociacao","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_ordemAtual","_listaNegociacoes","_mensagem","_service","_init","negociacoes","lista","forEach","negociacao","adiciona","erro","texto","setInterval","importarNegociacoes","event","preventDefault","_criaNegociacao","mensagem","cadastra","_limpaFormulario","apaga","esvazia","importa","coluna","inverteOrdem","ordena","a","b","value","focus","textoParaData","parseInt","parseFloat","negociacaoController","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { ListaNegociacoes } from \"../models/ListaNegociacoes\";\r\nimport { Mensagem } from \"../models/Mensagem\";\r\nimport { NegociacoesView } from \"../views/NegociacoesView\";\r\nimport { MensagemView } from \"../views/MensagemView\";\r\nimport { NegociacaoService } from \"../services/NegociacaoService\";\r\nimport { DateHelper } from \"../helpers/DateHelper\";\r\nimport { Bind } from \"../helpers/Bind\";\r\nimport { Negociacao } from \"../models/Negociacao\";\r\n\r\nclass NegociacaoController {\r\n  constructor() {\r\n    let $ = document.querySelector.bind(document);\r\n    this._inputData = $(\"#data\");\r\n    this._inputQuantidade = $(\"#quantidade\");\r\n    this._inputValor = $(\"#valor\");\r\n    this._ordemAtual = \"\";\r\n\r\n    this._listaNegociacoes = new Bind(\r\n      new ListaNegociacoes(),\r\n      new NegociacoesView($(\"#negociacoesView\")),\r\n      \"adiciona\",\r\n      \"esvazia\",\r\n      \"ordena\",\r\n      \"inverteOrdem\"\r\n    );\r\n\r\n    this._mensagem = new Bind(\r\n      new Mensagem(),\r\n      new MensagemView($(\"#mensagemView\")),\r\n      \"texto\"\r\n    );\r\n\r\n    this._service = new NegociacaoService();\r\n\r\n    this._init();\r\n  }\r\n\r\n  async _init() {\r\n    try {\r\n      let negociacoes = await this._service.lista();\r\n      negociacoes.forEach((negociacao) =>\r\n        this._listaNegociacoes.adiciona(negociacao)\r\n      );\r\n    } catch (erro) {\r\n      this._mensagem.texto = erro;\r\n    }\r\n\r\n    setInterval(() => {\r\n      this.importarNegociacoes();\r\n    }, 3000);\r\n  }\r\n\r\n  async adiciona(event) {\r\n    event.preventDefault();\r\n\r\n    try {\r\n      let negociacao = this._criaNegociacao();\r\n      let mensagem = await this._service.cadastra(negociacao);\r\n      this._listaNegociacoes.adiciona(negociacao);\r\n      this._mensagem.texto = mensagem;\r\n      this._limpaFormulario();\r\n    } catch (erro) {\r\n      this._mensagem.texto = erro;\r\n    }\r\n  }\r\n\r\n  async apaga() {\r\n    try {\r\n      let mensagem = await this._service.apaga();\r\n      this._mensagem.texto = mensagem;\r\n      this._listaNegociacoes.esvazia();\r\n    } catch (erro) {\r\n      this._mensagem.texto = erro;\r\n    }\r\n  }\r\n\r\n  async importarNegociacoes() {\r\n    try {\r\n      let negociacoes = await this._service.importa(\r\n        this._listaNegociacoes.negociacoes\r\n      );\r\n      negociacoes.forEach((negociacao) =>\r\n        this._listaNegociacoes.adiciona(negociacao)\r\n      );\r\n\r\n      this._mensagem.texto = \"Negociações do período importadas com sucesso\";\r\n    } catch (erro) {\r\n      this._mensagem.texto = erro;\r\n    }\r\n  }\r\n\r\n  ordena(coluna) {\r\n    if (this._ordemAtual == coluna) {\r\n      this._listaNegociacoes.inverteOrdem();\r\n      this._ordemAtual = \"\";\r\n    } else {\r\n      this._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);\r\n      this._ordemAtual = coluna;\r\n    }\r\n  }\r\n\r\n  _limpaFormulario() {\r\n    this._inputData.value = \"\";\r\n    this._inputQuantidade.value = 1;\r\n    this._inputValor.value = 0;\r\n\r\n    this._inputData.focus();\r\n  }\r\n\r\n  _criaNegociacao() {\r\n    return new Negociacao(\r\n      DateHelper.textoParaData(this._inputData.value),\r\n      parseInt(this._inputQuantidade.value),\r\n      parseFloat(this._inputValor.value)\r\n    );\r\n  }\r\n}\r\n\r\nlet negociacaoController = new NegociacaoController();\r\nexport function currentInstance() {\r\n  return negociacaoController;\r\n}\r\n"]}