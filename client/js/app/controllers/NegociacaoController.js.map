{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_ordemAtual","_listaNegociacoes","Bind","ListaNegociacoes","NegociacoesView","_mensagem","Mensagem","MensagemView","_service","NegociacaoService","_init","negociacoes","lista","forEach","negociacao","adiciona","erro","texto","setInterval","importarNegociacoes","event","preventDefault","_criaNegociacao","mensagem","cadastra","_limpaFormulario","apaga","esvazia","importa","coluna","inverteOrdem","ordena","a","b","value","focus","Negociacao","DateHelper","textoParaData","parseInt","parseFloat"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["class NegociacaoController {\r\n  constructor() {\r\n    let $ = document.querySelector.bind(document);\r\n    this._inputData = $(\"#data\");\r\n    this._inputQuantidade = $(\"#quantidade\");\r\n    this._inputValor = $(\"#valor\");\r\n    this._ordemAtual = \"\";\r\n\r\n    this._listaNegociacoes = new Bind(\r\n      new ListaNegociacoes(),\r\n      new NegociacoesView($(\"#negociacoesView\")),\r\n      \"adiciona\",\r\n      \"esvazia\",\r\n      \"ordena\",\r\n      \"inverteOrdem\"\r\n    );\r\n\r\n    this._mensagem = new Bind(\r\n      new Mensagem(),\r\n      new MensagemView($(\"#mensagemView\")),\r\n      \"texto\"\r\n    );\r\n\r\n    this._service = new NegociacaoService();\r\n\r\n    this._init();\r\n  }\r\n\r\n  async _init() {\r\n    try {\r\n      let negociacoes = await this._service.lista();\r\n      negociacoes.forEach((negociacao) =>\r\n        this._listaNegociacoes.adiciona(negociacao)\r\n      );\r\n    } catch (erro) {\r\n      this._mensagem.texto = erro;\r\n    }\r\n\r\n    setInterval(() => {\r\n      this.importarNegociacoes();\r\n    }, 3000);\r\n  }\r\n\r\n  async adiciona(event) {\r\n    event.preventDefault();\r\n\r\n    try {\r\n      let negociacao = this._criaNegociacao();\r\n      let mensagem = await this._service.cadastra(negociacao);\r\n      this._listaNegociacoes.adiciona(negociacao);\r\n      this._mensagem.texto = mensagem;\r\n      this._limpaFormulario();\r\n    } catch (erro) {\r\n      this._mensagem.texto = erro;\r\n    }\r\n  }\r\n\r\n  async apaga() {\r\n    try {\r\n      let mensagem = await this._service.apaga();\r\n      this._mensagem.texto = mensagem;\r\n      this._listaNegociacoes.esvazia();\r\n    } catch (erro) {\r\n      this._mensagem.texto = erro;\r\n    }\r\n  }\r\n\r\n  async importarNegociacoes() {\r\n    try {\r\n      let negociacoes = await this._service.importa(\r\n        this._listaNegociacoes.negociacoes\r\n      );\r\n      negociacoes.forEach((negociacao) =>\r\n        this._listaNegociacoes.adiciona(negociacao)\r\n      );\r\n\r\n      this._mensagem.texto = \"Negociações do período importadas com sucesso\";\r\n    } catch (erro) {\r\n      this._mensagem.texto = erro;\r\n    }\r\n  }\r\n\r\n  ordena(coluna) {\r\n    if (this._ordemAtual == coluna) {\r\n      this._listaNegociacoes.inverteOrdem();\r\n      this._ordemAtual = \"\";\r\n    } else {\r\n      this._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);\r\n      this._ordemAtual = coluna;\r\n    }\r\n  }\r\n\r\n  _limpaFormulario() {\r\n    this._inputData.value = \"\";\r\n    this._inputQuantidade.value = 1;\r\n    this._inputValor.value = 0;\r\n\r\n    this._inputData.focus();\r\n  }\r\n\r\n  _criaNegociacao() {\r\n    return new Negociacao(\r\n      DateHelper.textoParaData(this._inputData.value),\r\n      parseInt(this._inputQuantidade.value),\r\n      parseFloat(this._inputValor.value)\r\n    );\r\n  }\r\n}\r\n"]}